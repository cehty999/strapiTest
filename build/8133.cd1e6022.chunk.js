"use strict";(self.webpackChunktest_project=self.webpackChunktest_project||[]).push([[8133],{48133:(ge,w,n)=>{n.d(w,{E:()=>Ie,a:()=>K});var e=n(74081),m=n(27279),S=n(96226),h=n(10701),L=n(2878),k=n(77970),U=n(25191),A=n(4540),D=n(51094),R=n(10989),E=n(21395),$=n(67472),H=n(22572),N=n(73411),_=n(8295),he=n(61121),W=n(93415),F=n(23298),b=n(74577),V=n(12881),_e=n(1782),pe=n(27875),se=n(48102),Ee=n(74758),me=n(9941),j=n(27625),I=n(40464),te=n(51447),ne=n(59491),fe=n(36938),Me=n(34547),ae=n(59082),re=n(95066),ye=n(64820),Pe=n(76827),y=n(71563),i=n(70627),C=n(61020),ve=n(55108),oe=n(19003),O=n(47853);const xe=s=>s.reduce((t,a)=>{const r=a.split(".")[0];return t[r]||(t[r]=[]),t[r].push(a),t},{}),je=(0,oe.default)(S.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:s})=>s.colors.neutral100};
  }

  thead th span {
    color: ${({theme:s})=>s.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:s})=>s.spaces[3]};
    padding-block-end: ${({theme:s})=>s.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:s})=>s.spaces[2]};
  }
`,ie=s=>{const t=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return s&&(t.push({id:"app.utils.publish",defaultMessage:"Publish"}),t.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),t},Ce=s=>{const t=["entry.create","entry.update","entry.delete"];return s&&t.push("entry.publish","entry.unpublish"),{entry:t,media:["media.create","media.update","media.delete"]}},z=m.createContext(),le=({children:s})=>{const{formatMessage:t}=(0,C.Z)(),{collectionTypes:a,isLoading:r}=(0,ne.u)(),l=m.useMemo(()=>a.some(o=>o.options.draftAndPublish===!0),[a]),g=t({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return(0,e.jsx)(z.Provider,{value:{isDraftAndPublish:l},children:(0,e.jsxs)(h.k,{direction:"column",alignItems:"stretch",gap:1,children:[(0,e.jsx)(L.Q,{"aria-hidden":!0,children:g}),r&&(0,e.jsx)(k.a,{children:t({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})}),(0,e.jsx)(je,{"aria-label":g,children:s})]})})};le.propTypes={children:i.oneOfType([i.arrayOf(i.node),i.node]).isRequired};const X=({getHeaders:s=ie})=>{const{isDraftAndPublish:t}=m.useContext(z),{formatMessage:a}=(0,C.Z)(),r=s(t);return(0,e.jsx)(U.S,{children:(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(D.g,{children:(0,e.jsx)(R.T,{children:a({id:"Settings.webhooks.event.select",defaultMessage:"Select event"})})}),r.map(l=>["app.utils.publish","app.utils.unpublish"].includes(l.id)?(0,e.jsx)(D.g,{title:a({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"}),children:(0,e.jsx)(E.Z,{variant:"sigma",textColor:"neutral600",children:a(l)})},l.id):(0,e.jsx)(D.g,{children:(0,e.jsx)(E.Z,{variant:"sigma",textColor:"neutral600",children:a(l)})},l.id))]})})};X.defaultProps={getHeaders:ie},X.propTypes={getHeaders:i.func};const Q=({providedEvents:s})=>{const{isDraftAndPublish:t}=m.useContext(z),a=s||Ce(t),{values:r,handleChange:l}=(0,y.u6)(),g="events",o=r.events,f=[],P=xe(o),u=({target:{name:c,value:d}})=>{let p=new Set(o);d?p.add(c):p.delete(c),l({target:{name:g,value:Array.from(p)}})},M=({target:{name:c,value:d}})=>{let p=new Set(o);d?a[c].forEach(v=>{f.includes(v)||p.add(v)}):a[c].forEach(v=>p.delete(v)),l({target:{name:g,value:Array.from(p)}})};return(0,e.jsx)($.X,{children:Object.entries(a).map(([c,d])=>(0,e.jsx)(B,{disabledEvents:f,name:c,events:d,inputValue:P[c],handleSelect:u,handleSelectAll:M},c))})};Q.defaultProps={providedEvents:null},Q.propTypes={providedEvents:i.object};const Oe=s=>s.replace(/-/g," ").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "),B=({disabledEvents:s,name:t,events:a,inputValue:r,handleSelect:l,handleSelectAll:g})=>{const{formatMessage:o}=(0,C.Z)(),f=a.filter(d=>!s.includes(d)),P=r.length>0,u=r.length===f.length,M=({target:{name:d}})=>{g({target:{name:d,value:!u}})},c=5;return(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(D.f,{children:(0,e.jsx)(H.X,{indeterminate:P&&!u,"aria-label":o({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:t,onChange:M,value:u,children:Oe(t)})}),a.map(d=>(0,e.jsx)(D.f,{children:(0,e.jsx)(N.C,{disabled:s.includes(d),"aria-label":d,name:d,value:r.includes(d),onValueChange:p=>l({target:{name:d,value:p}})})},d)),a.length<c&&(0,e.jsx)(D.f,{colSpan:c-a.length})]})};B.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},B.propTypes={disabledEvents:i.array,events:i.array,inputValue:i.array,handleSelect:i.func,handleSelectAll:i.func,name:i.string.isRequired};const K={Root:le,Headers:X,Body:Q,EventRow:B};function De(){return(0,e.jsxs)(K.Root,{children:[(0,e.jsx)(K.Headers,{}),(0,e.jsx)(K.Body,{})]})}const de=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],G=({name:s,onChange:t,value:a,...r})=>{const{values:{headers:l}}=(0,y.u6)(),[g,o]=(0,m.useState)(de);(0,m.useEffect)(()=>{o(de.filter(u=>!l?.some(M=>M.key!==a&&M.key===u)))},[l,a]);const f=u=>{t({target:{name:s,value:u}})},P=u=>{o(M=>[...M,u]),f(u)};return(0,e.jsx)(_.XU,{...r,onClear:()=>f(""),onChange:f,onCreateOption:P,placeholder:"",value:a,children:g.map(u=>(0,e.jsx)(he.O,{value:u,children:u},u))})};G.defaultProps={value:void 0},G.propTypes={name:i.string.isRequired,onChange:i.func.isRequired,value:i.string};const be=()=>{const{formatMessage:s}=(0,C.Z)(),{values:t,errors:a}=(0,y.u6)();return(0,e.jsxs)(h.k,{direction:"column",alignItems:"stretch",gap:1,children:[(0,e.jsx)(L.Q,{children:s({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})}),(0,e.jsx)(W.x,{padding:8,background:"neutral100",hasRadius:!0,children:(0,e.jsx)(y.F2,{validateOnChange:!1,name:"headers",render:({push:r,remove:l})=>(0,e.jsxs)(F.r,{gap:4,children:[t.headers.map((g,o)=>(0,e.jsxs)(m.Fragment,{children:[(0,e.jsx)(b.P,{col:6,children:(0,e.jsx)(y.gN,{as:G,name:`headers.${o}.key`,"aria-label":`row ${o+1} key`,label:s({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:a.headers?.[o]?.key&&a.headers[o].key})}),(0,e.jsx)(b.P,{col:6,children:(0,e.jsxs)(h.k,{alignItems:"flex-end",children:[(0,e.jsx)(W.x,{style:{flex:1},children:(0,e.jsx)(y.gN,{as:V.o,name:`headers.${o}.value`,"aria-label":`row ${o+1} value`,label:s({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:a.headers?.[o]?.value&&a.headers[o].value})}),(0,e.jsx)(h.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:a.headers?.[o]?.value?0:5,children:(0,e.jsx)(j.RemoveRoundedButton,{disabled:t.headers.length===1,onClick:()=>l(o),label:s({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:o+1})})})]})})]},`${o}.${g.key}`)),(0,e.jsx)(b.P,{col:12,children:(0,e.jsx)(_e.A,{type:"button",onClick:()=>{r({key:"",value:""})},startIcon:(0,e.jsx)(fe.Z,{}),children:s({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"})})})]})})})]})},Z=oe.default.svg(({theme:s,color:t})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${s.colors[t]};
  }
`),J=({isPending:s,statusCode:t})=>{const{formatMessage:a}=(0,C.Z)();return s?(0,e.jsxs)(h.k,{gap:2,alignItems:"center",children:[(0,e.jsx)(Z,{as:Me.Z}),(0,e.jsx)(E.Z,{children:a({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"})})]}):t>=200&&t<300?(0,e.jsxs)(h.k,{gap:2,alignItems:"center",children:[(0,e.jsx)(Z,{as:ae.Z,color:"success700"}),(0,e.jsx)(E.Z,{children:a({id:"Settings.webhooks.trigger.success",defaultMessage:"success"})})]}):t>=300?(0,e.jsxs)(h.k,{gap:2,alignItems:"center",children:[(0,e.jsx)(Z,{as:re.Z,color:"danger700"}),(0,e.jsxs)(E.Z,{children:[a({id:"Settings.error",defaultMessage:"error"})," ",t]})]}):null};J.propTypes={isPending:i.bool.isRequired,statusCode:i.number},J.defaultProps={statusCode:void 0};const Y=({statusCode:s,message:t})=>{const{formatMessage:a}=(0,C.Z)();return s>=200&&s<300?(0,e.jsx)(h.k,{justifyContent:"flex-end",children:(0,e.jsx)(E.Z,{textColor:"neutral600",ellipsis:!0,children:a({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"})})}):s>=300?(0,e.jsx)(h.k,{justifyContent:"flex-end",children:(0,e.jsx)(h.k,{maxWidth:(0,j.pxToRem)(250),justifyContent:"flex-end",title:t,children:(0,e.jsx)(E.Z,{ellipsis:!0,textColor:"neutral600",children:t})})}):null};Y.propTypes={statusCode:i.number,message:i.string},Y.defaultProps={statusCode:void 0,message:void 0};const ce=({onCancel:s})=>{const{formatMessage:t}=(0,C.Z)();return(0,e.jsx)(h.k,{justifyContent:"flex-end",children:(0,e.jsx)("button",{onClick:s,type:"button",children:(0,e.jsxs)(h.k,{gap:2,alignItems:"center",children:[(0,e.jsx)(E.Z,{textColor:"neutral400",children:t({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})}),(0,e.jsx)(Z,{as:re.Z,color:"neutral400"})]})})})};ce.propTypes={onCancel:i.func.isRequired};const q=({isPending:s,onCancel:t,response:a})=>{const{statusCode:r,message:l}=a,{formatMessage:g}=(0,C.Z)();return(0,e.jsx)(W.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0,children:(0,e.jsxs)(F.r,{gap:4,style:{alignItems:"center"},children:[(0,e.jsx)(b.P,{col:3,children:(0,e.jsx)(E.Z,{children:g({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"})})}),(0,e.jsx)(b.P,{col:3,children:(0,e.jsx)(J,{isPending:s,statusCode:r})}),(0,e.jsx)(b.P,{col:6,children:s?(0,e.jsx)(ce,{onCancel:t}):(0,e.jsx)(Y,{statusCode:r,message:l})})]})})};q.defaultProps={isPending:!1,onCancel(){},response:{}},q.propTypes={isPending:i.bool,onCancel:i.func,response:i.object};const Te=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Ae=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,Re=({formatMessage:s})=>O.Ry().shape({name:O.Z_().required(s({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(Te,s({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:O.Z_().required(s({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Ae,s({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:O.Vo(t=>{let a=O.IX();if(t.length===1){const{key:r,value:l}=t[0];if(!r&&!l)return a}return a.of(O.Ry().shape({key:O.Z_().required(s({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:O.Z_().required(s({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:O.IX()}),ee=({handleSubmit:s,triggerWebhook:t,isCreating:a,isTriggering:r,triggerResponse:l,data:g})=>{const{formatMessage:o}=(0,C.Z)(),[f,P]=(0,m.useState)(!1),u=(0,ve.p)(De,async()=>(await n.e(3841).then(n.bind(n,43841))).EventTableEE),M=d=>Object.keys(d).length?Object.entries(d).map(([p,v])=>({key:p,value:v})):[{key:"",value:""}],c=(0,y.TA)({initialValues:{name:g?.name||"",url:g?.url||"",headers:M(g?.headers||{}),events:g?.events||[]},onSubmit(d,{resetForm:p,setSubmitting:v}){s(d),p({values:d}),v(!1)},validationSchema:Re({formatMessage:o}),validateOnChange:!1,validateOnBlur:!1});return u?(0,e.jsx)(y.Hy,{value:c,children:(0,e.jsxs)(j.Form,{onSubmit:c.handleSubmit,children:[(0,e.jsx)(pe.T,{primaryAction:(0,e.jsxs)(h.k,{gap:2,children:[(0,e.jsx)(se.z,{onClick:()=>{t(),P(!0)},variant:"tertiary",startIcon:(0,e.jsx)(ye.Z,{}),disabled:a||r,size:"L",children:o({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})}),(0,e.jsx)(se.z,{startIcon:(0,e.jsx)(ae.Z,{}),type:"submit",size:"L",disabled:!c.dirty,loading:c.isSubmitting,children:o({id:"global.save",defaultMessage:"Save"})})]}),title:a?o({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):g?.name,navigationAction:(0,e.jsx)(j.Link,{startIcon:(0,e.jsx)(Pe.Z,{}),to:"/settings/webhooks",children:o({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(Ee.D,{children:(0,e.jsxs)(h.k,{direction:"column",alignItems:"stretch",gap:4,children:[f&&(0,e.jsx)(q,{isPending:r,response:l,onCancel:()=>P(!1)}),(0,e.jsx)(W.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0,children:(0,e.jsxs)(h.k,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsxs)(F.r,{gap:6,children:[(0,e.jsx)(b.P,{col:6,children:(0,e.jsx)(y.gN,{as:V.o,name:"name",error:c?.errors?.name&&c.errors.name,label:o({id:"global.name",defaultMessage:"Name"}),required:!0})}),(0,e.jsx)(b.P,{col:12,children:(0,e.jsx)(y.gN,{as:V.o,name:"url",error:c?.errors?.url&&c.errors.url,label:o({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0})})]}),(0,e.jsx)(be,{}),(0,e.jsx)(u,{})]})})]})})]})}):null};ee.propTypes={data:i.object,handleSubmit:i.func.isRequired,triggerWebhook:i.func.isRequired,isCreating:i.bool.isRequired,isTriggering:i.bool.isRequired,triggerResponse:i.object},ee.defaultProps={data:void 0,triggerResponse:void 0};const ue=s=>({...s,headers:s.headers.reduce((t,{key:a,value:r})=>(a!==""&&(t[a]=r),t),{})}),Ie=()=>{const{params:{id:s}}=(0,te.$B)("/settings/webhooks/:id"),t=s==="create",{replace:a}=(0,te.k6)(),r=(0,j.useNotification)(),{formatAPIError:l}=(0,j.useAPIErrorHandler)(),g=(0,I.useQueryClient)(),{isLoading:o}=(0,ne.u)(),{put:f,get:P,post:u}=(0,j.useFetchClient)(),{isLoading:M,data:c,error:d}=(0,I.useQuery)(["webhooks",s],async()=>{const{data:{data:x}}=await P(`/admin/webhooks/${s}`);return x},{enabled:!t});m.useEffect(()=>{d&&r({type:"warning",message:l(d)})},[d,r,l]);const{isLoading:p,data:v,isIdle:Se,mutate:Le}=(0,I.useMutation)(()=>u(`/admin/webhooks/${s}/trigger`)),ke=()=>Le(null,{onError(x){r({type:"warning",message:l(x)})}}),Ue=(0,I.useMutation)(x=>u("/admin/webhooks",x)),We=(0,I.useMutation)(({id:x,body:T})=>f(`/admin/webhooks/${x}`,T)),Be=async x=>{if(t){Ue.mutate(ue(x),{onSuccess({data:T}){r({type:"success",message:{id:"Settings.webhooks.created"}}),a(`/settings/webhooks/${T.data.id}`)},onError(T){r({type:"warning",message:l(T)})}});return}We.mutate({id:s,body:ue(x)},{onSuccess(){g.invalidateQueries(["webhooks",s]),r({type:"success",message:{id:"notification.form.success.fields"}})},onError(T){r({type:"warning",message:l(T)})}})};return M||o?(0,e.jsx)(j.LoadingIndicatorPage,{}):(0,e.jsxs)(me.o,{children:[(0,e.jsx)(j.SettingsPageTitle,{name:"Webhooks"}),(0,e.jsx)(ee,{data:c,handleSubmit:Be,triggerWebhook:ke,isCreating:t,isTriggering:p,isTriggerIdle:Se,triggerResponse:v?.data.data})]})}},59491:(ge,w,n)=>{n.d(w,{u:()=>L});var e=n(27279),m=n(27625),S=n(53532),h=n(40464);function L(){const{get:k}=(0,m.useFetchClient)(),{formatAPIError:U}=(0,m.useAPIErrorHandler)(),A=(0,m.useNotification)(),D=(0,h.useQueries)([{queryKey:["content-manager","components"],async queryFn(){const{data:{data:_}}=await k("/content-manager/components");return _},onError(_){_ instanceof S.d7&&A({type:"warning",message:U(_)})}},{queryKey:["content-manager","content-types"],async queryFn(){const{data:{data:_}}=await k("/content-manager/content-types");return _},onError(_){_ instanceof S.d7&&A({type:"warning",message:U(_)})}}]),[R,E]=D,$=R.isLoading||E.isLoading,H=e.useMemo(()=>(E?.data??[]).filter(_=>_.kind==="collectionType"&&_.isDisplayed),[E?.data]),N=e.useMemo(()=>(E?.data??[]).filter(_=>_.kind!=="collectionType"&&_.isDisplayed),[E?.data]);return{isLoading:$,components:e.useMemo(()=>R?.data??[],[R?.data]),collectionTypes:H,singleTypes:N}}}}]);
