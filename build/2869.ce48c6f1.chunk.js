"use strict";(self.webpackChunktest_project=self.webpackChunktest_project||[]).push([[2869],{72869:(Te,X,a)=>{a.d(X,{App:()=>Ce});var e=a(74081),y=a(51447),i=a(10859),L=a(27279),Y=a(5938),k=a(6918),m=a(21395),q=a(15244),ee=a(12881),se=a(35250),v=a(48102),O=a(10701),W=a(9941),U=a(93415),N=a(27875),ae=a(68412),te=a(4987),ne=a(8990),T=a(74758),$=a(6191),ie=a(93153),S=a(50086),re=a(23298),le=a(74577),oe=a(69878),K=a(94098),Z=a(61908),t=a(27625),de=a(26784),ce=a(78665),ge=a(76827),ue=a(75438),z=a(52448),he=a(36938),A=a(61020),B=a(19003),H=a(71563),V=a(47853),me=a(79213);const _e=V.Ry().shape({name:V.Z_().trim().required()}).required().noUnknown(),F=({handleClose:s,handleSubmit:r,initialValues:o,isLoading:n=!1})=>{const{formatMessage:l}=(0,A.Z)();return(0,e.jsxs)(Y.P,{onClose:s,labelledBy:"title",children:[(0,e.jsx)(k.x,{children:(0,e.jsx)(m.Z,{id:"title",fontWeight:"bold",textColor:"neutral800",children:l({id:"content-releases.modal.add-release-title",defaultMessage:"New release"})})}),(0,e.jsx)(H.J9,{validateOnChange:!1,onSubmit:r,initialValues:o,validationSchema:_e,children:({values:_,errors:p,handleChange:M})=>(0,e.jsxs)(H.l0,{children:[(0,e.jsx)(q.f,{children:(0,e.jsx)(ee.o,{label:l({id:"content-releases.modal.form.input.label.release-name",defaultMessage:"Name"}),name:"name",value:_.name,error:p.name,onChange:M,required:!0})}),(0,e.jsx)(se.m,{startActions:(0,e.jsx)(v.z,{onClick:s,variant:"tertiary",name:"cancel",children:l({id:"cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(v.z,{name:"submit",loading:n,disabled:!_.name,type:"submit",children:l({id:"content-releases.modal.form.button.submit",defaultMessage:"Continue"})})})]})})]})},pe=(0,B.default)(O.k)`
  align-self: stretch;
  border-bottom-right-radius: ${({theme:s})=>s.borderRadius};
  border-bottom-left-radius: ${({theme:s})=>s.borderRadius};
  border-top: 1px solid ${({theme:s})=>s.colors.neutral150};
`,xe=(0,B.default)(O.k)`
  align-self: stretch;
`,fe=(0,B.default)(de.Z)`
  width: ${({theme:s})=>s.spaces[4]};
  height: ${({theme:s})=>s.spaces[4]};
  path {
    fill: ${({theme:s})=>s.colors.neutral600};
  }
`,Ee=(0,B.default)(ce.Z)`
  width: ${({theme:s})=>s.spaces[4]};
  height: ${({theme:s})=>s.spaces[4]};
  path {
    fill: ${({theme:s})=>s.colors.danger600};
  }
`,Q=({onClick:s,children:r})=>(0,e.jsx)(xe,{paddingTop:2,paddingBottom:2,paddingLeft:4,paddingRight:4,alignItems:"center",gap:2,as:"button",hasRadius:!0,onClick:s,children:r}),w=({toggleEditReleaseModal:s,toggleWarningSubmit:r,children:o})=>{const{formatMessage:n}=(0,A.Z)(),{releaseId:l}=(0,y.UO)(),[_,p]=L.useState(!1),M=L.useRef(null),{data:u,isLoading:f,isError:b}=(0,i.u)({id:l}),[I,{isLoading:C}]=(0,i.c)(),j=(0,t.useNotification)(),{formatAPIError:D}=(0,t.useAPIErrorHandler)(),d=u?.data,h=()=>{p(R=>!R)},g=()=>{s(),h()},P=async()=>{const R=await I({id:l});"data"in R?j({type:"success",message:n({id:"content-releases.pages.ReleaseDetails.publish-notification-success",defaultMessage:"Release was published successfully."})}):(0,i.i)(R.error)?j({type:"warning",message:D(R.error)}):j({type:"warning",message:n({id:"notification.error",defaultMessage:"An error occurred"})})},c=()=>{r(),h()};if(f)return(0,e.jsx)(W.o,{"aria-busy":f,children:(0,e.jsx)(U.x,{paddingBottom:8,children:(0,e.jsx)(t.LoadingIndicatorPage,{})})});if(b||!d)return(0,e.jsx)(W.o,{children:(0,e.jsx)(U.x,{paddingBottom:8,children:(0,e.jsx)(t.AnErrorOccurred,{})})});const x=d.actions.meta.count||0,E=`${d.createdBy.firstname} ${d.createdBy.lastname}`;return(0,e.jsxs)(W.o,{"aria-busy":f,children:[(0,e.jsx)(U.x,{paddingBottom:8,children:(0,e.jsx)(N.T,{title:d.name,subtitle:n({id:"content-releases.pages.Details.header-subtitle",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:x}),navigationAction:(0,e.jsx)(ae.r,{startIcon:(0,e.jsx)(ge.Z,{}),to:"/plugins/content-releases",children:n({id:"global.back",defaultMessage:"Back"})}),primaryAction:!d.releasedAt&&(0,e.jsxs)(O.k,{gap:2,children:[(0,e.jsx)(te.h,{label:n({id:"content-releases.header.actions.open-release-actions",defaultMessage:"Release actions"}),ref:M,onClick:h,children:(0,e.jsx)(ue.Z,{})}),_&&(0,e.jsxs)(ne.J2,{source:M,placement:"bottom-end",onDismiss:h,spacing:4,minWidth:"242px",children:[(0,e.jsxs)(O.k,{alignItems:"center",justifyContent:"center",direction:"column",padding:1,children:[(0,e.jsx)(t.CheckPermissions,{permissions:i.P.update,children:(0,e.jsxs)(Q,{onClick:g,children:[(0,e.jsx)(fe,{}),(0,e.jsx)(m.Z,{ellipsis:!0,children:n({id:"content-releases.header.actions.edit",defaultMessage:"Edit"})})]})}),(0,e.jsx)(t.CheckPermissions,{permissions:i.P.delete,children:(0,e.jsxs)(Q,{onClick:c,children:[(0,e.jsx)(Ee,{}),(0,e.jsx)(m.Z,{ellipsis:!0,textColor:"danger600",children:n({id:"content-releases.header.actions.delete",defaultMessage:"Delete"})})]})})]}),(0,e.jsxs)(pe,{direction:"column",justifyContent:"center",alignItems:"flex-start",gap:1,padding:5,children:[(0,e.jsx)(m.Z,{variant:"pi",fontWeight:"bold",children:n({id:"content-releases.header.actions.created",defaultMessage:"Created"})}),(0,e.jsxs)(m.Z,{variant:"pi",color:"neutral300",children:[(0,e.jsx)(t.RelativeTime,{timestamp:new Date(d.createdAt)}),n({id:"content-releases.header.actions.created.description",defaultMessage:" by {createdBy}"},{createdBy:E})]})]})]}),(0,e.jsx)(v.z,{size:"S",variant:"tertiary",children:n({id:"content-releases.header.actions.refresh",defaultMessage:"Refresh"})}),(0,e.jsx)(t.CheckPermissions,{permissions:i.P.publish,children:(0,e.jsx)(v.z,{size:"S",variant:"default",onClick:P,loading:C,disabled:d.actions.meta.count===0,children:n({id:"content-releases.header.actions.publish",defaultMessage:"Publish"})})})]})})}),o]})},Me=()=>{const{formatMessage:s}=(0,A.Z)(),{releaseId:r}=(0,y.UO)(),[{query:o}]=(0,t.useQueryParams)(),n=(0,t.useNotification)(),{formatAPIError:l}=(0,t.useAPIErrorHandler)(),{data:_,isLoading:p,isError:M}=(0,i.u)({id:r}),u=_?.data,{isLoading:f,isFetching:b,isError:I,data:C}=(0,i.d)({...o,releaseId:r}),[j]=(0,i.e)(),D=async(g,P)=>{const c=await j({params:{releaseId:r,actionId:P},body:{type:g.target.value}});"error"in c&&((0,i.i)(c.error)?n({type:"warning",message:l(c.error)}):n({type:"warning",message:s({id:"notification.error",defaultMessage:"An error occurred"})}))};if(f||p)return(0,e.jsx)(T.D,{children:(0,e.jsx)(t.LoadingIndicatorPage,{})});if(I||M||!u)return(0,e.jsx)(T.D,{children:(0,e.jsx)(t.AnErrorOccurred,{})});const d=C?.data,h=C?.meta;return!d||!d.length?(0,e.jsx)(T.D,{children:(0,e.jsx)($.x,{content:s({id:"content-releases.pages.Details.empty-state.content",defaultMessage:"This release is empty."}),icon:(0,e.jsx)(z.Z,{width:"10rem"})})}):(0,e.jsx)(T.D,{children:(0,e.jsxs)(O.k,{gap:4,direction:"column",alignItems:"stretch",children:[(0,e.jsx)(t.Table.Root,{rows:d.map(g=>({...g,id:Number(g.entry.id)})),colCount:d.length,isLoading:f,isFetching:b,children:(0,e.jsxs)(t.Table.Content,{children:[(0,e.jsxs)(t.Table.Head,{children:[(0,e.jsx)(t.Table.HeaderCell,{fieldSchemaType:"string",label:s({id:"content-releases.page.ReleaseDetails.table.header.label.name",defaultMessage:"name"}),name:"name"}),(0,e.jsx)(t.Table.HeaderCell,{fieldSchemaType:"string",label:s({id:"content-releases.page.ReleaseDetails.table.header.label.locale",defaultMessage:"locale"}),name:"locale"}),(0,e.jsx)(t.Table.HeaderCell,{fieldSchemaType:"string",label:s({id:"content-releases.page.ReleaseDetails.table.header.label.content-type",defaultMessage:"content-type"}),name:"content-type"}),(0,e.jsx)(t.Table.HeaderCell,{fieldSchemaType:"string",label:s({id:"content-releases.page.ReleaseDetails.table.header.label.action",defaultMessage:"action"}),name:"action"})]}),(0,e.jsx)(t.Table.LoadingBody,{}),(0,e.jsx)(t.Table.Body,{children:d.map(({id:g,type:P,entry:c})=>(0,e.jsxs)(ie.Tr,{children:[(0,e.jsx)(S.Td,{children:(0,e.jsx)(m.Z,{children:`${c.contentType.mainFieldValue||c.id}`})}),(0,e.jsx)(S.Td,{children:(0,e.jsx)(m.Z,{children:`${c?.locale?.name?c.locale.name:"-"}`})}),(0,e.jsx)(S.Td,{children:(0,e.jsx)(m.Z,{children:c.contentType.displayName||""})}),(0,e.jsx)(S.Td,{children:u.releasedAt?(0,e.jsx)(m.Z,{children:s({id:"content-releases.page.ReleaseDetails.table.action-published",defaultMessage:"This entry was <b>{isPublish, select, true {published} other {unpublished}}</b>."},{isPublish:P==="publish",b:x=>(0,e.jsx)(m.Z,{fontWeight:"bold",children:x})})}):(0,e.jsx)(i.R,{selected:P,handleChange:x=>D(x,g),name:`release-action-${g}-type`})})]},g))})]})}),(0,e.jsxs)(O.k,{paddingTop:4,alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(t.PageSizeURLQuery,{defaultValue:h?.pagination?.pageSize.toString()}),(0,e.jsx)(t.PaginationURLQuery,{pagination:{pageCount:h?.pagination?.pageCount||0}})]})]})})},je=()=>{const{formatMessage:s}=(0,A.Z)(),{releaseId:r}=(0,y.UO)(),o=(0,t.useNotification)(),{formatAPIError:n}=(0,t.useAPIErrorHandler)(),{push:l}=(0,y.k6)(),[_,p]=L.useState(!1),[M,u]=L.useState(!1),{isLoading:f,data:b,isSuccess:I}=(0,i.u)({id:r}),[C,{isLoading:j}]=(0,i.a)(),[D,{isLoading:d}]=(0,i.b)(),h=()=>{p(E=>!E)},g=()=>u(E=>!E);if(f)return(0,e.jsx)(w,{toggleEditReleaseModal:h,toggleWarningSubmit:g,children:(0,e.jsx)(T.D,{children:(0,e.jsx)(t.LoadingIndicatorPage,{})})});const P=I&&b?.data?.name||"",c=async E=>{const R=await C({id:r,name:E.name});"data"in R?o({type:"success",message:s({id:"content-releases.modal.release-updated-notification-success",defaultMessage:"Release updated."})}):(0,i.i)(R.error)?o({type:"warning",message:n(R.error)}):o({type:"warning",message:s({id:"notification.error",defaultMessage:"An error occurred"})}),h()},x=async()=>{const E=await D({id:r});"data"in E?l("/plugins/content-releases"):(0,i.i)(E.error)?o({type:"warning",message:n(E.error)}):o({type:"warning",message:s({id:"notification.error",defaultMessage:"An error occurred"})})};return(0,e.jsxs)(w,{toggleEditReleaseModal:h,toggleWarningSubmit:g,children:[(0,e.jsx)(Me,{}),_&&(0,e.jsx)(F,{handleClose:h,handleSubmit:c,isLoading:f||j,initialValues:{name:P||""}}),(0,e.jsx)(t.ConfirmDialog,{bodyText:{id:"content-releases.dialog.confirmation-message",defaultMessage:"Are you sure you want to delete this release?"},isOpen:M,isConfirmButtonLoading:d,onToggleDialog:g,onConfirm:x})]})},Pe=()=>(0,e.jsx)(t.CheckPermissions,{permissions:i.P.main,children:(0,e.jsx)(je,{})}),J=({isLoading:s,totalReleases:r,onClickAddRelease:o,children:n})=>{const{formatMessage:l}=(0,A.Z)();return(0,e.jsxs)(W.o,{"aria-busy":s,children:[(0,e.jsx)(N.T,{title:l({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"}),subtitle:!s&&l({id:"content-releases.pages.Releases.header-subtitle",defaultMessage:"{number, plural, =0 {No releases} one {# release} other {# releases}}"},{number:r}),primaryAction:(0,e.jsx)(t.CheckPermissions,{permissions:i.P.create,children:(0,e.jsx)(v.z,{startIcon:(0,e.jsx)(he.Z,{}),onClick:o,children:l({id:"content-releases.header.actions.add-release",defaultMessage:"New release"})})})}),n]})},De=(0,B.default)(me.r)`
  display: block;
`,G=({sectionTitle:s,releases:r=[],isError:o=!1})=>{const{formatMessage:n}=(0,A.Z)();return o?(0,e.jsx)(t.AnErrorOccurred,{}):r?.length===0?(0,e.jsx)($.x,{content:n({id:"content-releases.page.Releases.tab.emptyEntries",defaultMessage:"No releases"},{target:s}),icon:(0,e.jsx)(z.Z,{width:"10rem"})}):(0,e.jsx)(re.r,{gap:4,children:r.map(({id:l,name:_,actions:p})=>(0,e.jsx)(le.P,{col:3,s:6,xs:12,children:(0,e.jsx)(De,{href:`content-releases/${l}`,isExternal:!1,children:(0,e.jsxs)(O.k,{direction:"column",justifyContent:"space-between",padding:4,hasRadius:!0,background:"neutral0",shadow:"tableShadow",height:"100%",width:"100%",alignItems:"start",gap:2,children:[(0,e.jsx)(m.Z,{as:"h3",variant:"delta",fontWeight:"bold",children:_}),(0,e.jsx)(m.Z,{variant:"pi",children:n({id:"content-releases.page.Releases.release-item.entries",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:p.meta.count})})]})})},l))})},Re={name:""},ye=()=>{const[s,r]=L.useState(!1),o=(0,t.useNotification)(),{formatMessage:n}=(0,A.Z)(),{push:l}=(0,y.k6)(),{formatAPIError:_}=(0,t.useAPIErrorHandler)(),[{query:p},M]=(0,t.useQueryParams)(),u=(0,i.f)(p),[f,{isLoading:b}]=(0,i.g)(),{isLoading:I,isSuccess:C,isError:j}=u,D=()=>{r(c=>!c)};if(I)return(0,e.jsx)(J,{onClickAddRelease:D,isLoading:!0,children:(0,e.jsx)(T.D,{children:(0,e.jsx)(t.LoadingIndicatorPage,{})})});const d=C&&u.currentData?.meta?.pagination?.total||0,h=c=>{M({...p,page:1,pageSize:u?.currentData?.meta?.pagination?.pageSize||16,filters:{releasedAt:{$notNull:c!==0}}})},g=u?.currentData?.meta?.activeTab||"pending",P=async c=>{const x=await f({name:c.name});"data"in x?(o({type:"success",message:n({id:"content-releases.modal.release-created-notification-success",defaultMessage:"Release created."})}),l(`/plugins/content-releases/${x.data.data.id}`)):(0,i.i)(x.error)?o({type:"warning",message:_(x.error)}):o({type:"warning",message:n({id:"notification.error",defaultMessage:"An error occurred"})})};return(0,e.jsxs)(J,{onClickAddRelease:D,totalReleases:d,children:[(0,e.jsx)(T.D,{children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(oe.v,{label:n({id:"content-releases.pages.Releases.tab-group.label",defaultMessage:"Releases list"}),variant:"simple",initialSelectedTabIndex:["pending","done"].indexOf(g),onTabChange:h,children:[(0,e.jsx)(U.x,{paddingBottom:8,children:(0,e.jsxs)(K.m,{children:[(0,e.jsx)(K.O,{children:n({id:"content-releases.pages.Releases.tab.pending",defaultMessage:"Pending"})}),(0,e.jsx)(K.O,{children:n({id:"content-releases.pages.Releases.tab.done",defaultMessage:"Done"})})]})}),(0,e.jsxs)(Z.n,{children:[(0,e.jsx)(Z.x,{children:(0,e.jsx)(G,{sectionTitle:"pending",releases:u?.currentData?.data,isError:j})}),(0,e.jsx)(Z.x,{children:(0,e.jsx)(G,{sectionTitle:"done",releases:u?.currentData?.data,isError:j})})]})]}),d>0&&(0,e.jsxs)(O.k,{paddingTop:4,alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(t.PageSizeURLQuery,{options:["8","16","32","64"],defaultValue:u?.currentData?.meta?.pagination?.pageSize.toString()}),(0,e.jsx)(t.PaginationURLQuery,{pagination:{pageCount:u?.currentData?.meta?.pagination?.pageCount||0}})]})]})}),s&&(0,e.jsx)(F,{handleClose:D,handleSubmit:P,isLoading:b,initialValues:Re})]})},Oe=()=>(0,e.jsx)(t.CheckPermissions,{permissions:i.P.main,children:(0,e.jsx)(ye,{})}),Ce=()=>(0,e.jsxs)(y.rs,{children:[(0,e.jsx)(y.AW,{exact:!0,path:`/plugins/${i.p}`,component:Oe}),(0,e.jsx)(y.AW,{exact:!0,path:`/plugins/${i.p}/:releaseId`,component:Pe})]})}}]);
