(self.webpackChunktest_project=self.webpackChunktest_project||[]).push([[8833],{86961:(F,L,e)=>{var o=e(13578),M=e(27138),s="[object Boolean]";function R(n){return n===!0||n===!1||M(n)&&o(n)==s}F.exports=R},92249:(F,L,e)=>{var o=e(37997);function M(s){return o(s)&&s!=+s}F.exports=M},37997:(F,L,e)=>{var o=e(13578),M=e(27138),s="[object Number]";function R(n){return typeof n=="number"||M(n)&&o(n)==s}F.exports=R},76368:(F,L,e)=>{"use strict";e.d(L,{D:()=>n});var o=e(74081),M=e(93415),s=e(67621);function R(w,h,D){if(!w||!h||!D)return{display:"none"};const{x:A,y}=D;return{transform:`translate(${A}px, ${y}px)`}}const n=({renderItem:w})=>{const{itemType:h,isDragging:D,item:A,initialOffset:y,currentOffset:d,mouseOffset:z}=(0,s.useDragLayer)(S=>({item:S.getItem(),itemType:S.getItemType(),initialOffset:S.getInitialSourceClientOffset(),currentOffset:S.getSourceClientOffset(),isDragging:S.isDragging(),mouseOffset:S.getClientOffset()}));return D?(0,o.jsx)(M.x,{height:"100%",left:0,position:"fixed",pointerEvents:"none",top:0,zIndex:100,width:"100%",children:(0,o.jsx)(M.x,{style:R(y,d,z),children:w({type:h,item:A})})}):null}},55535:(F,L,e)=>{"use strict";e.d(L,{B:()=>k,D:()=>V,H:()=>se,R:()=>H});var o=e(74081),M=e(10701),s=e(21395),R=e(27997),n=e(9941),w=e(74758),h=e(27875),D=e(27625),A=e(10411),y=e(76827),d=e(61020),z=e(76368),S=e(47706),K=e(70627),T=e(19003);const X=(0,T.default)(M.k)`
  svg path {
    fill: ${({theme:j})=>j.colors.neutral600};
  }
`;function N({name:j}){return(0,o.jsxs)(M.k,{background:"primary100",borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",gap:3,hasRadius:!0,padding:3,shadow:"tableShadow",width:(0,D.pxToRem)(300),children:[(0,o.jsx)(X,{alignItems:"center",background:"neutral200",borderRadius:"50%",height:6,justifyContent:"center",width:6,children:(0,o.jsx)(A.Z,{width:`${8/16}rem`})}),(0,o.jsx)(s.Z,{fontWeight:"bold",children:j})]})}N.propTypes={name:K.string.isRequired};function b({type:j,item:J}){switch(j){case S.D.STAGE:return(0,o.jsx)(N,{...J});default:return null}}function V(){return(0,o.jsx)(z.D,{renderItem:b})}function H({children:j}){return(0,o.jsx)(R.A,{children:(0,o.jsx)(n.o,{tabIndex:-1,children:(0,o.jsx)(w.D,{children:j})})})}function k({href:j}){const{formatMessage:J}=(0,d.Z)();return(0,o.jsx)(D.Link,{startIcon:(0,o.jsx)(y.Z,{}),to:j,children:J({id:"global.back",defaultMessage:"Back"})})}function se({title:j,subtitle:J,navigationAction:ue,primaryAction:r}){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(D.SettingsPageTitle,{name:j}),(0,o.jsx)(h.T,{navigationAction:ue,primaryAction:r,title:j,subtitle:J})]})}},11745:(F,L,e)=>{"use strict";e.d(L,{a:()=>R,g:()=>s});var o=e(97003),M=e(47706);function s(n){if(!n)return null;const h=Object.entries(o.W.colors).filter(([,D])=>D.toUpperCase()===n.toUpperCase()).reduce((D,[A])=>(M.S?.[A]&&(D=A),D),null);return h?{themeColorName:h,name:M.S[h]}:null}function R(){return Object.entries(M.S).map(([n,w])=>({hex:o.W.colors[n].toUpperCase(),name:w}))}},24414:(F,L,e)=>{"use strict";e.d(L,{a:()=>J,b:()=>N,c:()=>k,d:()=>X,g:()=>S,i:()=>se,m:()=>b,s:()=>V,u:()=>T});var o=e(27279),M=e(67621),s=e(45648),R=e(55108),n=e(27625),w=e(98934),h=e(86961),D=e(10124),A=e(92249),y=e(51527),d=e(47853);const S=r=>`content-manager.${r}`;(0,o.createContext)();const K=(r,g,{onCancel:c,onDropItem:a,onGrabItem:E,onMoveItem:P})=>{const[p,I]=(0,o.useState)(!1),Y=G=>{p&&(G==="UP"?P(g-1,g):G==="DOWN"&&P(g+1,g))},B=()=>{p?(a&&a(g),I(!1)):(E&&E(g),I(!0))},C=()=>{p&&(I(!1),c&&c(g))};return G=>{if(r&&!(G.key==="Tab"&&!p))switch(G.preventDefault(),G.key){case" ":case"Enter":B();break;case"Escape":C();break;case"ArrowDown":case"ArrowRight":Y("DOWN");break;case"ArrowUp":case"ArrowLeft":Y("UP");break}}},T=(r,{type:g="STRAPI_DND",index:c,item:a={},onStart:E,onEnd:P,onGrabItem:p,onDropItem:I,onCancel:Y,onMoveItem:B,dropSensitivity:C="regular"})=>{const Q=(0,o.useRef)(null),[{handlerId:G},fe]=(0,M.useDrop)({accept:g,collect(x){return{handlerId:x.getHandlerId()}},hover(x,Oe){if(!Q.current)return;const ie=x.index,oe=c;if(ie!==oe){if(C==="regular"){const ge=Q.current.getBoundingClientRect(),me=(ge.bottom-ge.top)/2,le=Oe.getClientOffset().y-ge.top;if(ie<oe&&le<me||ie>oe&&le>me)return}B(oe,ie),x.index=oe}}}),[{isDragging:i},_e,q]=(0,M.useDrag)({type:g,item(){E&&E();const{width:x}=Q.current?.getBoundingClientRect()??{};return{index:c,width:x,...a}},end(){P&&P()},canDrag:r,isDragging:a.id?x=>a.id===x.getItem().id:void 0,collect:x=>({isDragging:x.isDragging()})}),ye=K(r,c,{onGrabItem:p,onDropItem:I,onCancel:Y,onMoveItem:B});return[{handlerId:G,isDragging:i,handleKeyDown:ye},Q,fe,_e,q]},X=()=>r=>r["content-manager_app"]||R.J,N=()=>(0,s.P1)(X(),r=>({collectionTypeLinks:r.collectionTypeLinks,singleTypeLinks:r.singleTypeLinks})),b=()=>(0,s.P1)(X(),({components:r,models:g})=>({schemas:[...r,...g]})),V=(0,s.P1)(X(),r=>r.fieldSizes),H=(r,g)=>{typeof r=="function"?r(g):r!=null&&(r.current=g)},k=(...r)=>g=>r.forEach(c=>H(c,g));function se(r){return["integer","biginteger","decimal","float","number"].includes(r)}d.kM(d.nK,"defined",function(){return this.test("defined",n.translatedErrors.required,r=>r!==void 0)}),d.kM(d.IX,"notEmptyMin",function(r){return this.test("notEmptyMin",n.translatedErrors.min,g=>D(g)?!0:g.length>=r)}),d.kM(d.Z_,"isInferior",function(r,g){return this.test("isInferior",r,function(c){return!c||Number.isNaN(y(c))?!0:y(g)>=y(c)})}),d.kM(d.Z_,"isSuperior",function(r,g){return this.test("isSuperior",r,function(c){return!c||Number.isNaN(y(c))?!0:y(c)>=y(g)})});const j=r=>w(r,["attributes"],{}),J=(r,{components:g},c={isCreatingEntry:!0,isDraft:!0,isFromComponent:!1,isJSONTestDisabled:!1})=>{const a=j(r);return d.Ry().shape(Object.keys(a).reduce((E,P)=>{const p=a[P];if(p.type!=="relation"&&p.type!=="component"&&p.type!=="dynamiczone"){const I=ue(p.type,p,c);E[P]=I}if(p.type==="relation"&&(E[P]=["oneWay","oneToOne","manyToOne","oneToManyMorph","oneToOneMorph"].includes(p.relationType)?d.Ry().nullable():d.IX().nullable()),p.type==="component"){const I=J(g[p.component],{components:g},{...c,isFromComponent:!0});if(p.repeatable===!0){const{min:B,max:C,required:Q}=p;let G=d.Vo(fe=>{let i=d.IX().of(I);return B?Q?i=i.min(B,n.translatedErrors.min):Q!==!0&&D(fe)?i=i.nullable():i=i.min(B,n.translatedErrors.min):Q&&!c.isDraft&&(i=i.min(1,n.translatedErrors.required)),C&&(i=i.max(C,n.translatedErrors.max)),i});return E[P]=G,E}const Y=d.Vo(B=>B!==void 0?p.required===!0&&!c.isDraft?I.defined():I.nullable():p.required===!0?d.Ry().defined():d.Ry().nullable());return E[P]=Y,E}if(p.type==="dynamiczone"){let I=d.IX().of(d.Vo(({__component:C})=>J(g[C],{components:g},{...c,isFromComponent:!0})));const{max:Y,min:B}=p;B?p.required?I=I.test("min",n.translatedErrors.min,C=>c.isCreatingEntry?C&&C.length>=B:C===void 0?!0:C!==null&&C.length>=B).test("required",n.translatedErrors.required,C=>c.isCreatingEntry?C!==null||C!==void 0:C===void 0?!0:C!==null):I=I.notEmptyMin(B):p.required&&!c.isDraft&&(I=I.test("required",n.translatedErrors.required,C=>c.isCreatingEntry?C!==null||C!==void 0:C===void 0?!0:C!==null)),Y&&(I=I.max(Y,n.translatedErrors.max)),E[P]=I}return E},{}))},ue=(r,g,c)=>{let a=d.nK();return["string","uid","text","richtext","email","password","enumeration"].includes(r)&&(a=d.Z_()),r==="blocks"&&(a=d.nK().test("isJSON",n.translatedErrors.json,E=>c.isJSONTestDisabled||c.isDraft?!0:!(E&&!Array.isArray(E)))),r==="json"&&(a=d.nK(n.translatedErrors.json).test("isJSON",n.translatedErrors.json,E=>{if(c.isJSONTestDisabled||!E||!E.length)return!0;try{return JSON.parse(E),!0}catch{return!1}}).nullable().test("required",n.translatedErrors.required,E=>!(g.required&&(!E||!E.length)))),r==="email"&&(a=a.email(n.translatedErrors.email)),["number","integer","float","decimal"].includes(r)&&(a=d.Rx().transform(E=>A(E)?void 0:E).typeError()),r==="biginteger"&&(a=d.Z_().matches(/^-?\d*$/)),["date","datetime"].includes(r)&&(a=d.hT()),Object.keys(g).forEach(E=>{const P=g[E];if(P||!h(P)&&Number.isInteger(Math.floor(P))||P===0)switch(E){case"required":{c.isDraft||(r==="password"&&c.isCreatingEntry&&(a=a.required(n.translatedErrors.required)),r!=="password"&&(c.isCreatingEntry?a=a.required(n.translatedErrors.required):a=a.test("required",n.translatedErrors.required,p=>p===void 0&&!c.isFromComponent?!0:se(r)?p===0?!0:!!p:r==="boolean"?p!=null:r==="date"||r==="datetime"?typeof p=="string"?!D(p):!D(p?.toString()):!D(p))));break}case"max":{r==="biginteger"?a=a.isInferior(n.translatedErrors.max,P):a=a.max(P,n.translatedErrors.max);break}case"maxLength":a=a.max(P,n.translatedErrors.maxLength);break;case"min":{r==="biginteger"?a=a.isSuperior(n.translatedErrors.min,P):a=a.min(P,n.translatedErrors.min);break}case"minLength":{c.isDraft||(a=a.min(P,n.translatedErrors.minLength));break}case"regex":a=a.matches(new RegExp(P),{message:n.translatedErrors.regex,excludeEmptyString:!g.required});break;case"lowercase":["text","textarea","email","string"].includes(r)&&(a=a.strict().lowercase());break;case"uppercase":["text","textarea","email","string"].includes(r)&&(a=a.strict().uppercase());break;case"positive":se(r)&&(a=a.positive());break;case"negative":se(r)&&(a=a.negative());break;default:a=a.nullable()}}),a}},73314:(F,L,e)=>{"use strict";e.d(L,{u:()=>n});var o=e(27279),M=e(27625),s=e(61020),R=e(40464);const n=(w={},h={})=>{const{id:D="",...A}=w,{get:y}=(0,M.useFetchClient)(),{locale:d}=(0,s.Z)(),z=(0,M.useCollator)(d,{sensitivity:"base"}),{data:S,error:K,isError:T,isLoading:X,refetch:N}=(0,R.useQuery)(["roles",D,A],async()=>{const{data:V}=await y(`/admin/roles/${D??""}`,{params:A});return V},h);return{roles:o.useMemo(()=>{let V=[];return S&&(Array.isArray(S.data)?V=S.data:V=[S.data]),[...V].sort((H,k)=>z.compare(H.name,k.name))},[S,z]),error:K,isError:T,isLoading:X,refetch:N}}},59491:(F,L,e)=>{"use strict";e.d(L,{u:()=>n});var o=e(27279),M=e(27625),s=e(53532),R=e(40464);function n(){const{get:w}=(0,M.useFetchClient)(),{formatAPIError:h}=(0,M.useAPIErrorHandler)(),D=(0,M.useNotification)(),A=(0,R.useQueries)([{queryKey:["content-manager","components"],async queryFn(){const{data:{data:T}}=await w("/content-manager/components");return T},onError(T){T instanceof s.d7&&D({type:"warning",message:h(T)})}},{queryKey:["content-manager","content-types"],async queryFn(){const{data:{data:T}}=await w("/content-manager/content-types");return T},onError(T){T instanceof s.d7&&D({type:"warning",message:h(T)})}}]),[y,d]=A,z=y.isLoading||d.isLoading,S=o.useMemo(()=>(d?.data??[]).filter(T=>T.kind==="collectionType"&&T.isDisplayed),[d?.data]),K=o.useMemo(()=>(d?.data??[]).filter(T=>T.kind!=="collectionType"&&T.isDisplayed),[d?.data]);return{isLoading:z,components:o.useMemo(()=>y?.data??[],[y?.data]),collectionTypes:S,singleTypes:K}}},88181:(F,L,e)=>{"use strict";e.d(L,{u:()=>R});var o=e(27279),M=e(27625),s=e(40464);function R(n={}){const{get:w}=(0,M.useFetchClient)(),{id:h="",...D}=n,A={populate:"stages"},{data:y,isLoading:d,status:z,refetch:S}=(0,s.useQuery)(["review-workflows","workflows",h],async()=>(await w(`/admin/review-workflows/workflows/${h}`,{params:{...A,...D}})).data),K=o.useMemo(()=>h&&y?.data?[y.data]:Array.isArray(y?.data)?y.data:[],[y?.data,h]);return{meta:o.useMemo(()=>y?.meta??{},[y?.meta]),workflows:K,isLoading:d,status:z,refetch:S}}},57860:(F,L,e)=>{"use strict";e.d(L,{S:()=>we,W:()=>Te,a:()=>qe,b:()=>ke,c:()=>Le,d:()=>ge,e:()=>Ve,f:()=>He,g:()=>Xe,h:()=>Pe,i:()=>Ye,j:()=>st,k:()=>et,l:()=>oe,r:()=>ze,s:()=>tt,u:()=>Oe,v:()=>gt});var o=e(27279),M=e(55108),s=e(74081),R=e(93415),n=e(21395),w=e(10701),h=e(97232),D=e(4987),A=e(10989),y=e(45322),d=e(24920),z=e(34642),S=e(23298),K=e(74577),T=e(12881),X=e(63738),N=e(27625),b=e(70627),V=e(61020),H=e(59461),k=e(19003),se=e(77225),j=e(75438),J=e(33039),ue=e(78031),r=e(69933),g=e(81740),c=e(71563),a=e(92241),E=e(24414),P=e(61815),p=e(8175),I=e(98934),Y=e(43433),B=e(74919),C=e(92249),Q=e(87830),G=e(3243),fe=e(29206),i=e(47706),_e=e(11745),q=e(45648),ye=e(6078),x=e(47853);function Oe(t,u){const f=(0,M.V)();(0,o.useEffect)(()=>{f.injectReducer(t,u)},[f,t,u])}function ie(t){return{type:i.j,payload:{id:t}}}function oe({workflow:t}){return{type:i.A,payload:t}}function ge({workflows:t}){return{type:i.c,payload:t}}function me(t){return{type:i.k,payload:{stageId:t}}}function Pe(t={}){return{type:i.d,payload:t}}function le(t,u){return{type:i.l,payload:{stageId:t,...u}}}function Ze(t){return{type:i.m,payload:t}}function Fe(t,u){return{type:i.n,payload:{newIndex:u,oldIndex:t}}}function be(t){return{type:i.i,payload:t}}function ze(){return{type:i.e}}function Ve(t){return{type:i.f,payload:t}}function He(t){return{type:i.g,payload:t}}function Xe(t){return{type:i.h,payload:t}}const ve=(0,k.default)(se.Z)`
  > circle {
    fill: ${({theme:t})=>t.colors.neutral150};
  }
  > path {
    fill: ${({theme:t})=>t.colors.neutral600};
  }
`,Je=(0,k.default)(R.x)`
  border-radius: 26px;

  svg {
    height: ${({theme:t})=>t.spaces[6]};
    width: ${({theme:t})=>t.spaces[6]};

    > path {
      fill: ${({theme:t})=>t.colors.neutral600};
    }
  }

  &:hover {
    color: ${({theme:t})=>t.colors.primary600} !important;
    ${n.Z} {
      color: ${({theme:t})=>t.colors.primary600} !important;
    }

    ${ve} {
      > circle {
        fill: ${({theme:t})=>t.colors.primary600};
      }
      > path {
        fill: ${({theme:t})=>t.colors.neutral100};
      }
    }
  }

  &:active {
    ${n.Z} {
      color: ${({theme:t})=>t.colors.primary600};
    }

    ${ve} {
      > circle {
        fill: ${({theme:t})=>t.colors.primary600};
      }
      > path {
        fill: ${({theme:t})=>t.colors.neutral100};
      }
    }
  }
`;function Ae({children:t,...u}){return(0,s.jsx)(Je,{as:"button",background:"neutral0",border:"neutral150",paddingBottom:3,paddingLeft:4,paddingRight:4,paddingTop:3,shadow:"filterShadow",...u,children:(0,s.jsxs)(w.k,{gap:2,children:[(0,s.jsx)(ve,{"aria-hidden":!0}),(0,s.jsx)(n.Z,{variant:"pi",fontWeight:"bold",textColor:"neutral500",children:t})]})})}Ae.propTypes={children:b.node.isRequired};const pe={serverState:{contentTypes:{collectionTypes:[],singleTypes:[]},roles:[],workflow:null,workflows:[]},clientState:{currentWorkflow:{data:{name:"",contentTypes:[],stages:[],permissions:void 0}},isLoading:!0}};function Ye(t=pe,u){return(0,P.Uy)(t,f=>{const{payload:v}=u;switch(u.type){case i.f:{f.serverState.contentTypes=v;break}case i.h:{f.clientState.isLoading=v;break}case i.g:{f.serverState.roles=v;break}case i.A:{const m=v;m&&(f.serverState.workflow=m,f.clientState.currentWorkflow.data={...m,stages:m.stages.map(O=>({...O,color:O?.color??i.b}))});break}case i.c:{f.serverState.workflows=v;break}case i.e:{f.clientState=pe.clientState,f.serverState=pe.serverState;break}case i.k:{const{stageId:m}=v,{currentWorkflow:O}=t.clientState;f.clientState.currentWorkflow.data.stages=O.data.stages.filter(W=>(W?.id??W.__temp_key__)!==m);break}case i.d:{const{currentWorkflow:m}=t.clientState;m.data||(f.clientState.currentWorkflow.data={stages:[]});const O=We(f.clientState.currentWorkflow.data.stages);f.clientState.currentWorkflow.data.stages.push({...v,color:v?.color??i.b,__temp_key__:O});break}case i.j:{const{currentWorkflow:m}=t.clientState,{id:O}=v,W=m.data.stages.findIndex($=>($?.id??$?.__temp_key__)===O),U=m.data.stages[W];f.clientState.currentWorkflow.data.stages.splice(W+1,0,{...U,id:void 0,__temp_key__:We(f.clientState.currentWorkflow.data.stages)});break}case i.l:{const{currentWorkflow:m}=t.clientState,{stageId:O,...W}=v;f.clientState.currentWorkflow.data.stages=m.data.stages.map(U=>(U.id??U.__temp_key__)===O?{...U,...W}:U);break}case i.m:{const{currentWorkflow:m}=t.clientState;f.clientState.currentWorkflow.data.stages=m.data.stages.map(O=>({...O,...v}));break}case i.n:{const{currentWorkflow:{data:{stages:m}}}=t.clientState,{newIndex:O,oldIndex:W}=v;if(O>=0&&O<m.length){const U=m[W];let $=[...m];$.splice(W,1),$.splice(O,0,U),f.clientState.currentWorkflow.data.stages=$}break}case i.i:{f.clientState.currentWorkflow.data={...f.clientState.currentWorkflow.data,...v};break}}})}const We=(t=[])=>{const u=t.map(f=>f.id??f.__temp_key__);return Math.max(...u,-1)+1},re=t=>t[i.R]??pe,Ge=(0,q.P1)(re,({serverState:{contentTypes:t}})=>t),Le=(0,q.P1)(re,({serverState:{roles:t}})=>t),ke=(0,q.P1)(re,({clientState:{currentWorkflow:t}})=>t.data),Qe=(0,q.P1)(re,({serverState:{workflows:t}})=>t),qe=(0,q.P1)(re,({serverState:t,clientState:{currentWorkflow:u}})=>!ye(t.workflow,u.data)),et=(0,q.P1)(re,({serverState:t,clientState:{currentWorkflow:u}})=>!(t.workflow?.stages??[]).every(f=>!!u.data.stages.find(({id:v})=>v===f.id))),tt=(0,q.P1)(re,({clientState:{isLoading:t}})=>t),st=(0,q.P1)(re,({serverState:t})=>t),rt=(0,k.default)(h.ML)`
  padding-left: ${({theme:t})=>t.spaces[7]};
`,nt=(0,k.default)(w.k)`
  > * {
    flex-grow: 1;
  }
`,at=(0,k.default)(r.sN)`
  color: ${({theme:t})=>t.colors.danger600};
`,ot=(0,k.default)(g.xz)`
  :hover,
  :focus {
    background-color: ${({theme:t})=>t.colors.neutral100};
  }

  > span {
    font-size: 0;
  }
`,it=(0,k.default)(D.h)`
  align-items: center;
  border-radius: ${({theme:t})=>t.borderRadius};
  display: flex;
  justify-content: center;

  :hover,
  :focus {
    background-color: ${({theme:t})=>t.colors.neutral100};
  }

  svg {
    height: auto;
    width: ${({theme:t})=>t.spaces[3]}};
  }
`,lt=(0,_e.a)();function dt(){return(0,s.jsx)(R.x,{background:"primary100",borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",display:"block",hasRadius:!0,padding:6,shadow:"tableShadow"})}function je({id:t,index:u,canDelete:f,canReorder:v,canUpdate:m,isOpen:O=!1,stagesCount:W}){const U=_=>`${_+1} of ${W}`,$=_=>{de(l({id:"dnd.grab-item",defaultMessage:"{item}, grabbed. Current position in list: {position}. Press up and down arrow to change position, Spacebar to drop, Escape to cancel."},{item:ae.value,position:U(_)}))},Ce=_=>{de(l({id:"dnd.drop-item",defaultMessage:"{item}, dropped. Final position in list: {position}."},{item:ae.value,position:U(_)}))},Re=()=>{de(l({id:"dnd.cancel-item",defaultMessage:"{item}, dropped. Re-order cancelled."},{item:ae.value}))},Ee=(_,Z)=>{de(l({id:"dnd.reorder",defaultMessage:"{item}, moved. New position in list: {position}."},{item:ae.value,position:U(_)})),te(Fe(Z,_))},xe=()=>{Ie(!0)},[he,de]=o.useState(null),{formatMessage:l}=(0,V.Z)(),{trackUsage:ee}=(0,N.useTracking)(),te=(0,H.I0)(),ne=(0,N.useNotification)(),[Se,ft]=o.useState(O),[mt,Ie]=o.useState(!1),[ae,Be,pt]=(0,c.U$)(`stages.${u}.name`),[De,Ue,Et]=(0,c.U$)(`stages.${u}.color`),[ce,Ke,ht]=(0,c.U$)(`stages.${u}.permissions`),Dt=(0,H.v9)(Le),[{handlerId:Mt,isDragging:yt,handleKeyDown:Ot},Pt,vt,wt,Ne]=(0,E.u)(v,{index:u,item:{name:ae.value},onGrabItem:$,onDropItem:Ce,onMoveItem:Ee,onCancel:Re,type:i.D.STAGE}),Tt=(0,E.c)(Pt,vt),Ct=lt.map(({hex:_,name:Z})=>({value:_,label:l({id:"Settings.review-workflows.stage.color.name",defaultMessage:"{name}"},{name:Z}),color:_})),{themeColorName:Rt}=(0,_e.g)(De.value)??{},$e=Dt.filter(_=>_.code!=="strapi-super-admin");return o.useEffect(()=>{Ne((0,a.rX)(),{captureDraggingState:!1})},[Ne,u]),(0,s.jsxs)(R.x,{ref:Tt,children:[he&&(0,s.jsx)(A.T,{"aria-live":"assertive",children:he}),yt?(0,s.jsx)(dt,{}):(0,s.jsxs)(y.U,{size:"S",variant:"primary",onToggle:()=>{ft(!Se),Se||ee("willEditStage")},expanded:Se,shadow:"tableShadow",error:Be.error??Ue?.error??Ke?.error??!1,hasErrorMessage:!1,children:[(0,s.jsx)(d.B,{title:ae.value,togglePosition:"left",action:(f||m)&&(0,s.jsxs)(w.k,{children:[(0,s.jsxs)(g.fC,{children:[(0,s.jsxs)(ot,{size:"S",endIcon:null,paddingLeft:2,paddingRight:2,children:[(0,s.jsx)(j.Z,{"aria-hidden":!0,focusable:!1}),(0,s.jsx)(A.T,{as:"span",children:l({id:"[tbdb].components.DynamicZone.more-actions",defaultMessage:"More actions"})})]}),(0,s.jsx)(g.VY,{popoverPlacement:"bottom-end",zIndex:2,children:(0,s.jsxs)(g.rl,{children:[m&&(0,s.jsx)(r.sN,{onClick:()=>te(ie(t)),children:l({id:"Settings.review-workflows.stage.delete",defaultMessage:"Duplicate stage"})}),f&&(0,s.jsx)(at,{onClick:()=>te(me(t)),children:l({id:"Settings.review-workflows.stage.delete",defaultMessage:"Delete"})})]})})]}),m&&(0,s.jsx)(it,{background:"transparent",forwardedAs:"div",hasRadius:!0,role:"button",noBorder:!0,tabIndex:0,"data-handler-id":Mt,ref:wt,label:l({id:"Settings.review-workflows.stage.drag",defaultMessage:"Drag"}),onClick:_=>_.stopPropagation(),onKeyDown:Ot,children:(0,s.jsx)(J.Z,{})})]})}),(0,s.jsx)(z.v,{padding:6,background:"neutral0",hasRadius:!0,children:(0,s.jsxs)(S.r,{gap:4,children:[(0,s.jsx)(K.P,{col:6,children:(0,s.jsx)(T.o,{...ae,id:ae.name,disabled:!m,label:l({id:"Settings.review-workflows.stage.name.label",defaultMessage:"Stage name"}),error:Be.error??!1,onChange:_=>{pt.setValue(_.target.value),te(le(t,{name:_.target.value}))},required:!0})}),(0,s.jsx)(K.P,{col:6,children:(0,s.jsx)(X.q4,{disabled:!m,error:Ue?.error??!1,id:De.name,required:!0,label:l({id:"content-manager.reviewWorkflows.stage.color",defaultMessage:"Color"}),onChange:_=>{Et.setValue(_),te(le(t,{color:_}))},value:De.value.toUpperCase(),startIcon:(0,s.jsx)(w.k,{as:"span",height:2,background:De.value,borderColor:Rt==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2}),children:Ct.map(({value:_,label:Z,color:Me})=>{const{themeColorName:xt}=(0,_e.g)(Me);return(0,s.jsx)(X.ag,{value:_,startIcon:(0,s.jsx)(w.k,{as:"span",height:2,background:Me,borderColor:xt==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2}),children:Z},_)})})}),(0,s.jsx)(K.P,{col:6,children:$e.length===0?(0,s.jsx)(N.NotAllowedInput,{description:{id:"Settings.review-workflows.stage.permissions.noPermissions.description",defaultMessage:"You don\u2019t have the permission to see roles"},intlLabel:{id:"Settings.review-workflows.stage.permissions.label",defaultMessage:"Roles that can change this stage"},name:ce.name}):(0,s.jsxs)(w.k,{alignItems:"flex-end",gap:3,children:[(0,s.jsx)(nt,{grow:1,children:(0,s.jsx)(h.NU,{...ce,disabled:!m,error:Ke.error??!1,id:ce.name,label:l({id:"Settings.review-workflows.stage.permissions.label",defaultMessage:"Roles that can change this stage"}),onChange:_=>{const Z=_.map(Me=>({role:parseInt(Me,10),action:"admin::review-workflows.stage.transition"}));ht.setValue(Z),te(le(t,{permissions:Z}))},placeholder:l({id:"Settings.review-workflows.stage.permissions.placeholder",defaultMessage:"Select a role"}),required:!0,value:(ce.value??[]).map(_=>`${_.role}`),withTags:!0,children:[{label:l({id:"Settings.review-workflows.stage.permissions.allRoles.label",defaultMessage:"All roles"}),children:$e.map(_=>({value:`${_.id}`,label:_.name}))}].map(_=>"children"in _?(0,s.jsx)(h.Ab,{label:_.label,values:_.children.map(Z=>Z.value),children:_.children.map(Z=>(0,s.jsx)(rt,{value:Z.value,children:Z.label},Z.value))},_.label):(0,s.jsx)(h.ML,{value:_.value,children:_.label},_.value))})}),(0,s.jsx)(D.h,{disabled:!m,icon:(0,s.jsx)(ue.Z,{}),label:l({id:"Settings.review-workflows.stage.permissions.apply.label",defaultMessage:"Apply to all stages"}),size:"L",variant:"secondary",onClick:()=>xe(ce.value)})]})})]})})]}),(0,s.jsx)(N.ConfirmDialog.Root,{iconRightButton:null,isOpen:mt,onToggleDialog:()=>Ie(!1),onConfirm:()=>{te(Ze({permissions:ce.value})),Ie(!1),ne({type:"success",message:l({id:"Settings.review-workflows.page.edit.confirm.stages.permissions.copy.success",defaultMessage:"Applied roles to all other stages of the workflow"})})},variantRightButton:"primary",children:(0,s.jsx)(N.ConfirmDialog.Body,{children:(0,s.jsx)(n.Z,{textAlign:"center",variant:"omega",children:l({id:"Settings.review-workflows.page.edit.confirm.stages.permissions.copy",defaultMessage:"Roles that can change that stage will be applied to all the other stages."})})})})]})}je.propTypes=b.shape({id:b.number.isRequired,color:b.string.isRequired,canDelete:b.bool.isRequired,canReorder:b.bool.isRequired,canUpdate:b.bool.isRequired,stagesCount:b.number.isRequired}).isRequired;const ct=(0,k.default)(R.x)`
  transform: translateX(-50%);
`;function we({canDelete:t,canUpdate:u,stages:f}){const{formatMessage:v}=(0,V.Z)(),m=(0,H.I0)(),{trackUsage:O}=(0,N.useTracking)();return(0,s.jsxs)(w.k,{direction:"column",gap:6,width:"100%",children:[(0,s.jsxs)(R.x,{position:"relative",spacing:4,width:"100%",children:[(0,s.jsx)(ct,{background:"neutral200",height:"100%",left:"50%",position:"absolute",top:"0",width:2,zIndex:1}),(0,s.jsx)(w.k,{direction:"column",alignItems:"stretch",gap:6,zIndex:2,position:"relative",as:"ol",children:f.map((W,U)=>{const $=W?.id??W.__temp_key__;return(0,s.jsx)(R.x,{as:"li",children:(0,s.jsx)(je,{id:$,index:U,isOpen:!W.id,canDelete:f.length>1&&t,canReorder:f.length>1,canUpdate:u,stagesCount:f.length})},`stage-${$}`)})})]}),u&&(0,s.jsx)(Ae,{type:"button",onClick:()=>{m(Pe({name:""})),O("willCreateStage")},children:v({id:"Settings.review-workflows.stage.add",defaultMessage:"Add new stage"})})]})}we.defaultProps={canDelete:!0,canUpdate:!0,stages:[]},we.propTypes={canDelete:b.bool,canUpdate:b.bool,stages:b.arrayOf(b.shape({id:b.number,__temp_key__:b.number,name:b.string.isRequired}))};const ut=(0,k.default)(h.ML)`
  padding-left: ${({theme:t})=>t.spaces[7]};
`,_t=(0,k.default)(n.Z)`
  font-style: italic;
`;function Te({canUpdate:t}){const{formatMessage:u,locale:f}=(0,V.Z)(),v=(0,H.I0)(),{collectionTypes:m,singleTypes:O}=(0,H.v9)(Ge),W=(0,H.v9)(ke),U=(0,H.v9)(Qe),[$,Ce,Re]=(0,c.U$)("name"),[Ee,xe,he]=(0,c.U$)("contentTypes"),de=(0,N.useCollator)(f,{sensitivity:"base"});return(0,s.jsxs)(S.r,{background:"neutral0",hasRadius:!0,gap:4,padding:6,shadow:"tableShadow",children:[(0,s.jsx)(K.P,{col:6,children:(0,s.jsx)(T.o,{...$,id:$.name,disabled:!t,label:u({id:"Settings.review-workflows.workflow.name.label",defaultMessage:"Workflow Name"}),error:Ce.error??!1,onChange:l=>{v(be({name:l.target.value})),Re.setValue(l.target.value)},required:!0})}),(0,s.jsx)(K.P,{col:6,children:(0,s.jsx)(h.NU,{...Ee,customizeContent:l=>u({id:"Settings.review-workflows.workflow.contentTypes.displayValue",defaultMessage:"{count} {count, plural, one {content type} other {content types}} selected"},{count:l.length}),disabled:!t,error:xe.error??!1,id:Ee.name,label:u({id:"Settings.review-workflows.workflow.contentTypes.label",defaultMessage:"Associated to"}),onChange:l=>{v(be({contentTypes:l})),he.setValue(l)},placeholder:u({id:"Settings.review-workflows.workflow.contentTypes.placeholder",defaultMessage:"Select"}),children:[...m.length>0?[{label:u({id:"Settings.review-workflows.workflow.contentTypes.collectionTypes.label",defaultMessage:"Collection Types"}),children:[...m].sort((l,ee)=>de.compare(l.info.displayName,ee.info.displayName)).map(l=>({label:l.info.displayName,value:l.uid}))}]:[],...O.length>0?[{label:u({id:"Settings.review-workflows.workflow.contentTypes.singleTypes.label",defaultMessage:"Single Types"}),children:[...O].map(l=>({label:l.info.displayName,value:l.uid}))}]:[]].map(l=>"children"in l?(0,s.jsx)(h.Ab,{label:l.label,values:l.children.map(ee=>ee.value.toString()),children:l.children.map(ee=>{const{name:te}=U.find(ne=>(W&&ne.id!==W.id||!W)&&ne.contentTypes.includes(ee.value))??{};return(0,s.jsx)(ut,{value:ee.value,children:u({id:"Settings.review-workflows.workflow.contentTypes.assigned.notice",defaultMessage:"{label} {name, select, undefined {} other {<i>(assigned to <em>{name}</em> workflow)</i>}}"},{label:ee.label,name:te,em:(...ne)=>(0,s.jsx)(n.Z,{as:"em",fontWeight:"bold",children:ne}),i:(...ne)=>(0,s.jsx)(_t,{children:ne})})},ee.value)})},l.label):(0,s.jsx)(h.ML,{value:l.value,children:l.label},l.value))})})]})}Te.defaultProps={canUpdate:!0},Te.propTypes={canUpdate:b.bool};async function gt({values:t,formatMessage:u}){const f=x.Ry({contentTypes:x.IX().of(x.Z_()),name:x.Z_().max(255,u({id:"Settings.review-workflows.validation.name.max-length",defaultMessage:"Name can not be longer than 255 characters"})).required(),stages:x.IX().of(x.Ry().shape({name:x.Z_().required(u({id:"Settings.review-workflows.validation.stage.name",defaultMessage:"Name is required"})).max(255,u({id:"Settings.review-workflows.validation.stage.max-length",defaultMessage:"Name can not be longer than 255 characters"})).test("unique-name",u({id:"Settings.review-workflows.validation.stage.duplicate",defaultMessage:"Stage name must be unique"}),function(v){const{options:{context:m}}=this;return m.stages.filter(O=>O.name===v).length===1}),color:x.Z_().required(u({id:"Settings.review-workflows.validation.stage.color",defaultMessage:"Color is required"})).matches(/^#(?:[0-9a-fA-F]{3}){1,2}$/i),permissions:x.IX(x.Ry({role:x.Rx().strict().typeError(u({id:"Settings.review-workflows.validation.stage.permissions.role.number",defaultMessage:"Role must be of type number"})).required,action:x.Z_().required({id:"Settings.review-workflows.validation.stage.permissions.action.required",defaultMessage:"Action is a required argument"})})).strict()})).min(1)});try{return await f.validate(t,{abortEarly:!1,context:t}),!0}catch(v){let m={};return v instanceof x.p8&&v.inner.forEach(O=>{Y(m,O.path,O.message)}),m}}}}]);
